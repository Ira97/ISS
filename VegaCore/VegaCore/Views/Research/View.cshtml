
@model             Models.ViewModels.ResearchViewModel

@{
    ViewBag.Title = "Исследование";
    Layout = "_Layout";
}

<div class="d-flex justify-content-center">
    @using (Html.BeginForm("View", "Research", FormMethod.Post, new { role = "form", @class = "col-lg-7" }))
    {
        <h1>Исследование</h1>
        @Html.ValidationSummary(true)
        @Html.HiddenFor(m => m.SectionId, new { @value = Model.Research.SectionId })
        @Html.HiddenFor(m => m.AdvancedPropertyCount)
        <div class="form-group">
            <label>Название*</label>
            @Html.TextBoxFor(m => m.Research.Title, new { placeholder = "Введие название исследования", @required = true, @class = "form-control is-invalid", @value = Model.Research.Title })
            @Html.ValidationMessageFor(m => m.Research.Title)
        </div>
        <div class="form-group">
            <label>Авторы*</label>
            @Html.TextBoxFor(m => m.Research.Author, new { placeholder = "Введите авторов через запятую", @required = true, @class = "form-control", @value = Model.Research.Author })
            @Html.ValidationMessageFor(m => m.Research.Author)
        </div>
        <div class="form-group">
            <label>Описание результата*</label>
            @Html.TextAreaFor(m => m.Research.Description, new { placeholder = "Введите описание результата", @required = true, @class = "form-control", @value = Model.Research.Description, rows = 5 })
            @Html.ValidationMessageFor(m => m.Research.Description)
        </div>
        <div class="form-group">
            <label>Объект*</label>
            @Html.TextBoxFor(m => m.Research.Object, new { placeholder = "Введите объект исследования", @required = true, @class = "form-control", @value = Model.Research.Object })
            @Html.ValidationMessageFor(m => m.Research.Description)
        </div>
        <div class="form-group">
            <label>Связанные объекты*</label>
            @Html.ListBoxFor(m => m.Research.SelectedObjectList, new MultiSelectList(Model.DataObjectList, "Id", "Name", Model.Research.SelectedObjectList), new { @class = "form-control form-control-chosen", data_live_search = "true"})
        </div>
        <div class="form-group">
            <label>Предмет*</label>
            @Html.TextBoxFor(m => m.Research.Description, new { placeholder = "Введите предмет исследования", @required = true, @class = "form-control", @value = Model.Research.Thing })
            @Html.ValidationMessageFor(m => m.Research.Description)
        </div>
        <div class="form-group">
            <label>Метод*</label>
            @Html.TextBoxFor(m => m.Research.Description, new { placeholder = "Введите метод исследования", @required = true, @class = "form-control", @value = Model.Research.Method })
            @Html.ValidationMessageFor(m => m.Research.Description)
        </div>
        <div id="advanced-property-group">
            <label>Дополнительные свойства</label>
            <div class="form-group">
                <button type="button" class="btn btn-primary" onclick="addProperty()">Добавить</button>
            </div>
        </div>


        @*<div class="form-group">
                <label>E-mail гостя</label>
                @Html.TextBoxFor(m => m.Research.Email, new { placeholder = "email@example.com", @class = "form-control", @value = Model.Research.Email, type = "email" })
                @Html.ValidationMessageFor(m => m.Research.Email)
            </div>
            <div class="form-group">
                <label>Подразделение</label>
                @Html.DropDownListFor(model => model.Research.Unit, Html.GetEnumSelectList(typeof(SubDivision)), "Подразделение", new { @class = "form-control" })
            </div>
            <div class="form-group">
                <label>Тип обращения</label>
                @Html.ListBoxFor(model => model.Research.SelectedTypeList, new MultiSelectList(Model.TypeList, "Key", "Value", Model.Research.SelectedTypeList), new { @class = "form-control", data_live_search = "true", @style = "height: auto" })
            </div>
            <div class="form-group">
                <label>Ресторан*</label>
                @Html.DropDownListFor(model => model.Research.Rest, new SelectList(Model.RestaurantList, "Ident", "GenRestName", Model.Research.Rest), "Выберите ресторан", new { @class = "form-control", id = "restaurant" })
                @Html.ValidationMessageFor(model => model.Research.Rest, "", new { @class = "text-danger" })
            </div>
            <div class="form-group">
                <label>Бренд</label>
                @Html.ListBoxFor(model => model.Research.BrandsSelected, new MultiSelectList(Model.BrandList, "Key", "Value", Model.Research.BrandsSelected), new { @class = "form-control", data_live_search = "true", @style = "height: auto", id = "brands" })
            </div>
            <div class="form-group">
                <label>Виновный</label>
                @Html.TextBoxFor(m => m.Research.Guilty, new { placeholder = "Виновный", @class = "form-control", @value = Model.Research.Guilty })
                @Html.ValidationMessageFor(m => m.Research.Guilty)
            </div>
            <div class="form-group">
                <label>Ответственный</label>
                @Html.TextBoxFor(m => m.Research.Employee, new { placeholder = "Ответственный", @class = "form-control", @value = Model.Research.Employee })
                @Html.ValidationMessageFor(m => m.Research.Employee)
            </div>
            <div class="form-group">
                <label>Источник отзыва</label>
                @Html.DropDownListFor(model => model.Research.Source, Html.GetEnumSelectList(typeof(Source)), "Источник отзыва", new { @class = "form-control" })
            </div>
            <div class="form-group">
                <label>Дата создания*</label>
                @Html.TextBoxFor(model => model.Research.CreateDateTime, "{0:dd.MM.yyyy}", new { placeholder = "Введите дату поступления отзыва", @class = "form-control date", @required = "required", @autocomplete = "off", @value = @Model.Research.CreateDateTime, id = "createDateTime" })
                @Html.ValidationMessageFor(model => model.Research.CreateDateTime)
            </div>
            <div class="form-group">
                <label>Дата закрытия</label>
                @Html.TextBoxFor(m => m.Research.CloseDateTime, new { placeholder = "Введите дату закрытия отзыва", @class = "form-control date", @value = Model.Research.CloseDateTime, @autocomplete = "off" })
            </div>
            <div class="form-group">
                <label>Оценка</label>
                @Html.DropDownListFor(model => model.Research.Rating, Html.GetEnumSelectList(typeof(Rating)), "Выберите оценку", new { @class = "form-control" })
            </div>
            <div class="form-group">
                <label>Доп. инфо</label>
                @Html.DropDownListFor(model => model.Research.AdvancedInfo, Html.GetEnumSelectList(typeof(AdvancedInfo)), "Доп. инфо", new { @class = "form-control" })
            </div>
            <div class="form-group">
                <label>Текст отзыва*</label>
                @Html.TextAreaFor(m => m.Research.Text, new { placeholder = "Введите текст отзыва гостя", @required = true, @class = "form-control", @value = Model.Research.Text, rows = "4" })
                @Html.ValidationMessageFor(m => m.Research.Text)
            </div>
            <div class="form-group">
                <label>Суть обращения*</label>
                @Html.TextAreaFor(m => m.Research.Problem, new { placeholder = "Подробности проблемы", @required = true, @class = "form-control", @value = Model.Research.Problem, rows = "4" })
                @Html.ValidationMessageFor(m => m.Research.Problem)
            </div>
            <div class="form-group">
                <label>Принятые меры</label>
                @Html.TextAreaFor(m => m.Research.Measure, new { placeholder = "Опишите принятые меры", @class = "form-control", @value = Model.Research.Measure, rows = "4" })
                @Html.ValidationMessageFor(m => m.Research.Measure)
            </div>
            <div class="form-group">
                <label>Решение для гостя:</label>
                @Html.TextAreaFor(m => m.Research.Answer, new { placeholder = "Опишите решение для гостя", @class = "form-control", @value = Model.Research.Answer, rows = "4" })
                @Html.ValidationMessageFor(m => m.Research.Answer)
            </div>
            <div class="form-group">
                <label>Комментарий менеджера</label>
                @Html.TextAreaFor(m => m.Research.ManagerComment, new { placeholder = "Комментарий менеджера", @class = "form-control", @value = Model.Research.ManagerComment })
                @Html.ValidationMessageFor(m => m.Research.ManagerComment)
            </div>
            <div class="form-group">
                <label>Цена решения</label>
                @Html.TextBoxFor(m => m.Research.Cost, new { placeholder = "Цена решения", @class = "form-control", @value = Model.Research.Cost, @id = "oplata5" })
            </div>
            <div class="form-group">
                <label>Цена решения (баллы)</label>
                @Html.TextBoxFor(m => m.Research.CostPoint, new { placeholder = "Цена решения (баллы)", @class = "form-control", @id = "oplata6", @value = Model.Research.CostPoint })
            </div>
            <div class="form-group">
                <label>Цена решения (сертификат)</label>
                @Html.TextBoxFor(m => m.Research.CostSert, new { placeholder = "Цена решения (сертификат)", @class = "form-control", @value = Model.Research.CostSert })
            </div>
            <div class="form-group">
                <label>Цена решения (скидка)</label>
                @Html.TextBoxFor(m => m.Research.CostDiscount, new { placeholder = "Цена решения (скидка)", @class = "form-control", @value = Model.Research.CostDiscount })
            </div>
            <div class="form-group">
                <label>Кто оплатил</label>
                @Html.DropDownListFor(model => model.Research.Payer, Html.GetEnumSelectList(typeof(Payer)), "Кто оплатил", new { @class = "form-control" })
            </div>*@
        <button type="submit" class="btn btn-primary" id="btnSubmit">Сохранить</button>
    }
</div>
<script>
    function addProperty() {
        var count = $("#AdvancedPropertyCount").val();
        const group = document.getElementById(`advanced-property-group`);
        group.insertAdjacentHTML('beforeend',
            `<div class="form-row" id="advanced-property-row${count}">
                <div class="form-group col-5">
                    <input class="form-control" name="CouponRule.CouponRuleNeedConditionValues[${count}].Value" placeholder="Введите наименование" type="text">
                </div>
                <div class="form-group col-6">
                    <input name="CouponRule.CouponRuleNeedConditionValues[${count}].CouponRuleId" hidden/>
                    <input class="form-control" name="CouponRule.CouponRuleNeedConditionValues[${count}].Value" placeholder="Введите значение" type="text">
                </div>
                <div class="form-group col-1 cross-container">
                    <button type="button" class="close" aria-label="Close" onclick="deleteProperty()">
                    <span aria-hidden="true">×</span>
                    </button>
                </div>
            </div>`);
        count++;
        $("#AdvancedPropertyCount").val(count);
    }

    function deleteProperty() {
        var count = $("#AdvancedPropertyCount").val();
        count--;
        const original = document.getElementById(`advanced-property-row${count}`);
        original.remove();
        $("#AdvancedPropertyCount").val(count);
    };

</script>